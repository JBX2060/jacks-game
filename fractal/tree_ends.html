<!DOCTYPE html>
<html>
    <head>

    </head>
    <body>
        <canvas id="canvas" width="4096" height="4096"></canvas>
        <script>
            var c = document.getElementById("canvas");
            var ctx = c.getContext("2d");
            
            var tc = 0;

            function tree(x, y, d, m, rule, depth) {
                tc++;
                var w = Math.cos(d) * m;
                var h = Math.sin(d) * m;
                if (depth > 0) {
                    rule.forEach(function (e) {
                    if (tc % 1000000 != 0) {
                        tree(x + w, y + h, d + e[0], m * e[1], rule, depth - 1);
                    } else {
                        setTimeout(function () { tree(x + w, y + h, d + e[0], m * e[1], rule, depth - 1); }, 0)
                    }
                });
                } else {
                    if (dt[Math.floor(y) * 4 * c.width + Math.floor(x) * 4] < 255) {
                        dt[Math.floor(y) * 4 * c.width + Math.floor(x) * 4] += 1;
                    } else if (dt[Math.floor(y) * 4 * c.width + Math.floor(x) * 4 + 1] < 255) {
                        dt[Math.floor(y) * 4 * c.width + Math.floor(x) * 4 + 1] += 1;
                    } else {
                        dt[Math.floor(y) * 4 * c.width + Math.floor(x) * 4 + 2] += 1;
                    }
                }
            }

            var t = {
                x: 2048,
                y: 3200,
                d: -Math.PI / 2,
                m: 560,
                rule: [[0.5, 0.8], [-0.5, 0.8]],
                depth: 30
            };

            var l = 0;

            var data, dt;

            ctx.fillRect(0, 0, c.width, c.width);
            data = ctx.getImageData(0, 0, c.width, c.width);
            dt = data.data;
            
            t.rule[0][0] = 0.5 + Math.pow(Math.random() * 2 - 1, 3) * 0
            t.rule[1][0] = -0.5 + Math.pow(Math.random() * 2 - 1, 3) * 0
            tree(t.x, t.y, t.d, t.m, t.rule, t.depth);

            function loop() {
                ctx.putImageData(data, 0, 0);
                l++;
                requestAnimationFrame(loop);
            }
            loop();
        </script>
    </body>
</html>